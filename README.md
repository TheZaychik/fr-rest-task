# fr-rest-task
### Тестовое задание (REST API)
***
#### Общая информация
Задание:
> Задача: спроектировать и разработать API для системы опросов пользователей.  
> Функционал для администратора системы:
>- авторизация в системе (регистрация не нужна)
>- добавление/изменение/удаление опросов. Атрибуты опроса: название, дата старта, дата окончания, описание. После создания поле "дата старта" у опроса менять нельзя
>- добавление/изменение/удаление вопросов в опросе. Атрибуты вопросов: текст вопроса, тип вопроса (ответ текстом, ответ с выбором одного варианта, ответ с выбором нескольких вариантов) 
> 
> Функционал для пользователей системы:
>- получение списка активных опросов
>- прохождение опроса: опросы можно проходить анонимно, в качестве идентификатора пользователя в API передаётся числовой ID, по которому сохраняются ответы пользователя на вопросы; один пользователь может участвовать в любом количестве опросов
>- получение пройденных пользователем опросов с детализацией по ответам (что выбрано) по ID уникальному пользователя

Использованные технологии Django 2.2.10 + DRF + MySQL
#### Внешние зависимости: 
```python
Django==2.2.10
djangorestframework==3.12.4
mysqlclient==2.0.3
pytz==2021.1
sqlparse==0.4.1
```
#### Развертывание:
1. Скачать репозиторий, и перенести файлы на свою машину (или сервер);
2. Установить Python версии, не ниже 3.8  
``$ sudo apt-get install python3``
3. Создать виртуальное окружение (удалив старое)  
``$ rm -rf venv``  
``$ python3 -m venv venv`` 
4. Подключить виртуальное окружение  
``$ source venv/bin/activate``   
5. Установить внешние зависимости в виртуальное окружение  
``$ pip3 install -r requirements.txt``
6. Установить MySQL (версии 8) на сервер  
``$ sudo apt install mysql-server mysql-client``
7. Произвести первоначальную настройку БД  
``$ sudo mysql_secure_installation``  
8. Создать базу данных и специального пользователя для сервиса  
```mysql
CREATE DATABASE <database>; # <имя_базы>
CREATE USER '<username>'@'localhost' IDENTIFIED BY 'password';
GRANT ALL ON <database>.* TO '<username>'@'localhost';
```
9. В `rest/rest/settings.py` сконфигурировать настройки DATABASES, прописав имя БД, а так же пользователя для взаимодействия
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'HOST': '127.0.0.1',
        'NAME': "<database>",
        'USER': '<username>',
        'PASSWORD': '<password>',
    },
}
```
10. Провести миграции в БД  
``$ python3 manage.py migrate``
11. Запустить решение  
``$ python3 manage.py runserver 0.0.0.0:8080``
***
#### Документация по API
### /polls ['POST', 'PATCH', 'DELETE', 'GET'] 
- name - имя голосования
- start_date - начало голосования
- end_date - конец голосования
- description - описание голосования 
- Методы:
   * POST - создание голосования
   * PATCH - изменение голосования
   * DELETE - удаление голосования
   * GET - список ВСЕХ голосований с вопросами
    
Пример запроса:    
```json
{
    "name": "Poll 1",
    "start_date": "2021-05-12T07:24:08.023058",
    "end_date": "2021-05-13T07:24:08.023058",
    "description": "Standart poll"
}
```
Пример ответа:
```json
[
    {
        "poll_id": 1,
        "name": "Poll 1",
        "start_date": "2021-05-12T07:24:08.023058Z",
        "end_date": "2021-05-13T07:24:08.023058Z",
        "description": "Standart poll",
        "questions": [
            {
                "poll": 1,
                "type": "one_variant",
                "question": "How are you?",
                "answers": [
                    "1.Good",
                    "2.Normal",
                    "3.Bad"
                ]
            }
        ]
    }
]
```
### /questions ['POST', 'PATCH', 'DELETE']
- poll_name - имя голосования, к которому привязывается вопрос
- type - тип голосования (ответ текстом, ответ с выбором одного варианта, ответ с выбором нескольких вариантов)
- question - вопрос голосования
- answers - варианты ответа 
- Методы:
   * POST - создание голосования
   * PATCH - изменение голосования
   * DELETE - удаление голосования
   * GET - список всех голосований с вопросами
    
Пример запроса:    
```json
{
    "poll_name": "Poll 1",
    "type" : "one_variant",
    "question": "How are you?",
    "answers": [
        "1.Good",
        "2.Normal",
        "3.Bad"
    ]
}
```
### /auth ['POST', 'GET']
- username - имя пользователя
- password - пароль пользователя
- Методы:
   * POST - авторизация
   * GET - выход из системы
    
Пример запроса:    
```json
{
    "username":"test_user",
    "password":"test_user"
}
```
### /userpolls ['POST', 'GET']
- user_id - id пользователя
- polls - список голосований
- poll_id - id голосования
- "How are you?" - словарь типа {вопрос : [ответ(ы)]}
- Методы:
   * POST - прохождение голосования
   * GET - просмотр активных голосований
    
Пример запроса:    
```json
{
    "user_id": 1,
    "polls": [
        {
            "poll_id": 1,
            "How are you?": [
                "1.Good"
            ]
        }
    ]
}
```
Пример ответа:
```json
[
    {
        "poll_id": 1,
        "name": "Poll 1",
        "start_date": "2021-05-12T07:24:08.023058Z",
        "end_date": "2021-05-13T07:24:08.023000Z",
        "description": "Standart poll",
        "questions": [
            {
                "poll": 1,
                "type": "one_variant",
                "question": "How are you?",
                "answers": [
                    "1.Good",
                    "2.Normal",
                    "3.Bad"
                ]
            }
        ]
    }
]
```
### /userpolls ['POST', 'GET']
- user_id - id пользователя
- Методы:
   * POST - просмотр пройденных голосований
    
Пример запроса:    
```json
{
    "user_id": 1
}
```
Пример ответа:
```json
[
    {
        "poll_id": 1,
        "How are you?": [
            "1.Good"
        ]
    }
]
```